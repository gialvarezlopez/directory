{% extends 'app/base.html.twig' %}

{% block title_page %}
    DB || Gallery
{% endblock %}

{% block breadcrumb %}
    {# {{ include('EmrBundle:consulta:_breadcrumb.html.twig' )  }} #}
{% endblock %}

{% block submenutop %}
    {# {{ include('EmrBundle:consulta:_submenu.html.twig' )  }} #}
{% endblock %}



{% block header %}
        <h1>Set my profile image</h1>
{% endblock %}

{% block content %}


<div class="row">
	  		<div class="col-md-4 text-center">
				<div id="upload-image"></div>
	  		</div>
	  		<div class="col-md-4">
				<strong>Select Image:</strong>
				<br/>
				<input type="file" id="images">
				<br/>
				<button class="btn btn-success cropped_image">Upload Image</button>
	  		</div>
	  		<div class="col-md-4 crop_preview">
				<div id="upload-image-i"></div>
	  		</div>
</div>
{% endblock %}

{% block codejs %}
    <script>
        //$(document).on("ready", function(){
        $(function () {
            // initialize with defaults

            $image_crop = $('#upload-image').croppie({
                enableExif: true,
                viewport: {
                    width: 200,
                    height: 200,
                    type: 'square'
                },
                boundary: {
                    width: 300,
                    height: 300
                }
            });
            $('#images').on('change', function () {

                var countFiles = $(this)[0].files.length;

                var imgPath = $(this)[0].value;
                var extn = imgPath.substring(imgPath.lastIndexOf('.') + 1).toLowerCase();


                if (extn == "gif" || extn == "png" || extn == "jpg" || extn == "jpeg") {
                    var image_holder = $("#image-holder");
                    image_holder.empty();
                    if (typeof (FileReader) != "undefined") {

                        //loop for each file selected for uploaded.
                        for (var i = 0; i < countFiles; i++) {

                            var reader = new FileReader();
                            reader.onload = function (e) {
                                $("<img/>", {
                                    "src": e.target.result,
                                        "class": "thumb-image img-thumbnail"
                                }).appendTo(image_holder);
                            }

                            image_holder.show();
                            reader.readAsDataURL($(this)[0].files[i]);
                        }


                    } else {
                        alert("This browser does not support FileReader.");
                    }
                } else {

                    $.alert({
                            icon: 'fa fa-warning',
                            title: 'Error!',
                            type: "red",
                            content: 'Please select only images',
                        });
                    $("#images").val("");
                }


                var reader = new FileReader();
                reader.onload = function (e) {
                    $image_crop.croppie('bind', {
                        url: e.target.result
                    }).then(function(){
                        console.log('jQuery bind complete');
                    });
                }
                reader.readAsDataURL(this.files[0]);
            });

            $('.cropped_image').on('click', function (ev) {


                $image_crop.croppie('result', {
                    type: 'canvas',
                    size: 'viewport'
                }).then(function (response) {
                    $.ajax({
                        url: "http://coderszine.com/demo/crop-image-and-upload-using-jquery-and-php/upload.php",
                        type: "POST",
                        data: {"image":response},
                        success: function (data) {
                            html = '<img src="' + response + '" />';
                            $("#upload-image-i").html(html);
                        }
                    });
                });
            });

        });
    </script>
{% endblock %}
